<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam DLCé…ç½®ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #1a1a2e;
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .container {
            background-color: #16213e;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        header {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            padding: 30px 40px;
            text-align: center;
            border-bottom: 3px solid #00adb5;
        }
        
        h1 {
            color: #00adb5;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            color: #8a8a8a;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .description {
            color: #b0b0b0;
            max-width: 800px;
            margin: 0 auto;
            font-size: 1rem;
            line-height: 1.7;
        }
        
        .content {
            padding: 30px;
        }
        
        .card {
            background-color: #1a1a2e;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #00adb5;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .card h2 {
            color: #00adb5;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card h2 i {
            font-size: 1.8rem;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        input {
            flex: 1;
            padding: 15px;
            background-color: #0f3460;
            border: 2px solid #1a508b;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: #00adb5;
            box-shadow: 0 0 0 3px rgba(0, 173, 181, 0.2);
        }
        
        button {
            background: linear-gradient(to right, #00adb5, #00858f);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        button:hover {
            background: linear-gradient(to right, #00858f, #006a72);
            transform: translateY(-2px);
            box-shadow: 0 7px 15px rgba(0, 173, 181, 0.3);
        }
        
        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .secondary-btn {
            background: linear-gradient(to right, #393e46, #222831);
        }
        
        .secondary-btn:hover {
            background: linear-gradient(to right, #222831, #1a1a2e);
        }
        
        .success-btn {
            background: linear-gradient(to right, #00b894, #00a085);
        }
        
        .success-btn:hover {
            background: linear-gradient(to right, #00a085, #008b74);
        }
        
        .dll-btn {
            background: linear-gradient(to right, #f39c12, #e67e22);
        }
        
        .dll-btn:hover {
            background: linear-gradient(to right, #e67e22, #d35400);
            transform: translateY(-2px);
            box-shadow: 0 7px 15px rgba(230, 126, 34, 0.3);
        }
        
        .progress-container {
            background-color: #0f3460;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #1a1a2e;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #00adb5, #00b894);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .output {
            background-color: #0f3460;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        .output h3 {
            color: #00adb5;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-content {
            background-color: #1a1a2e;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            margin-bottom: 20px;
            border: 1px solid #2d4059;
        }
        
        .dlc-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .dlc-item {
            background-color: #1a1a2e;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #00adb5;
        }
        
        .dlc-id {
            color: #00adb5;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .dlc-name {
            color: #e0e0e0;
            margin-top: 5px;
            word-break: break-word;
        }
        
        .error {
            background-color: #2d132c;
            border-left: 5px solid #c72c41;
            color: #ee4540;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .success {
            background-color: #1e3c2a;
            border-left: 5px solid #00b894;
            color: #55efc4;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .warning {
            background-color: #3c2d1e;
            border-left: 5px solid #f39c12;
            color: #f1c40f;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .instructions {
            background-color: #0f3460;
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .instructions h3 {
            color: #00adb5;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ol {
            padding-left: 20px;
            margin-bottom: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .footer {
            text-align: center;
            color: #8a8a8a;
            padding: 20px;
            font-size: 0.9rem;
            border-top: 1px solid #2d4059;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
            
            .dlc-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-gamepad"></i> Steam DLCé…ç½®ç”Ÿæˆå™¨</h1>
            <p class="subtitle">åœ¨çº¿ç”Ÿæˆcream_api.inié…ç½®æ–‡ä»¶ï¼Œè§£é”Steamæ¸¸æˆDLCå†…å®¹</p>
            <p class="description">
                æ­¤å·¥å…·é€šè¿‡Steam APIè·å–æ¸¸æˆDLCä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„cream_api.inié…ç½®æ–‡ä»¶ã€‚
                é€‚ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ï¼Œè¯·æ”¯æŒæ­£ç‰ˆæ¸¸æˆã€‚
            </p>
        </header>
        
        <div class="content">
            <div class="warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>å…è´£å£°æ˜ï¼š</strong>æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚è¯·å°Šé‡æ¸¸æˆå¼€å‘è€…çš„åŠ³åŠ¨æˆæœï¼Œæ”¯æŒæ­£ç‰ˆæ¸¸æˆã€‚ä½¿ç”¨è€…éœ€è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨é£é™©ã€‚
            </div>
            
            <div class="card">
                <h2><i class="fas fa-search"></i> è·å–æ¸¸æˆä¿¡æ¯</h2>
                <p>è¯·è¾“å…¥Steamæ¸¸æˆçš„App IDï¼ˆå•†åº—é“¾æ¥ä¸­çš„æ•°å­—ï¼‰ï¼Œä¾‹å¦‚ï¼š292030ï¼ˆå·«å¸ˆ3ï¼‰</p>
                
                <div class="input-group">
                    <input type="number" id="appId" placeholder="è¯·è¾“å…¥Steam App ID" min="1" value="292030">
                    <button id="fetchBtn">
                        <i class="fas fa-download"></i> è·å–DLCä¿¡æ¯
                    </button>
                </div>
                
                <div class="buttons">
                    <button id="testBtn" class="secondary-btn">
                        <i class="fas fa-wifi"></i> æµ‹è¯•ç½‘ç»œè¿æ¥
                    </button>
                    <button id="clearBtn" class="secondary-btn">
                        <i class="fas fa-trash"></i> æ¸…ç©ºç»“æœ
                    </button>
                    <button id="downloadDllBtn" class="dll-btn">
                        <i class="fas fa-file-archive"></i> ä¸‹è½½DLLæ–‡ä»¶
                    </button>
                </div>
            </div>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-text">
                    <span id="progressStep">å‡†å¤‡ä¸­...</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            
            <div class="error" id="errorContainer">
                <i class="fas fa-times-circle"></i>
                <span id="errorMessage">é”™è¯¯ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</span>
            </div>
            
            <div class="success" id="successContainer">
                <i class="fas fa-check-circle"></i>
                <span id="successMessage">æˆåŠŸä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</span>
            </div>
            
            <div class="output" id="outputContainer">
                <h3><i class="fas fa-list-alt"></i> æ¸¸æˆä¿¡æ¯</h3>
                <div id="gameInfo">æ¸¸æˆä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
                
                <h3><i class="fas fa-download"></i> é…ç½®æ–‡ä»¶é¢„è§ˆ</h3>
                <div class="config-content" id="configPreview">
                    é…ç½®æ–‡ä»¶å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
                </div>
                
                <div class="buttons">
                    <button id="downloadBtn" class="success-btn">
                        <i class="fas fa-file-download"></i> ä¸‹è½½é…ç½®æ–‡ä»¶
                    </button>
                    <button id="copyBtn" class="secondary-btn">
                        <i class="fas fa-copy"></i> å¤åˆ¶é…ç½®å†…å®¹
                    </button>
                </div>
                
                <div id="dlcContainer">
                    <!-- DLCåˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> ä½¿ç”¨è¯´æ˜</h3>
                <ol>
                    <li>è¾“å…¥Steamæ¸¸æˆçš„App IDï¼ˆå¯åœ¨å•†åº—é¡µé¢URLä¸­æ‰¾åˆ°ï¼Œå¦‚https://store.steampowered.com/app/<strong>292030</strong>/ï¼‰</li>
                    <li>ç‚¹å‡»"è·å–DLCä¿¡æ¯"æŒ‰é’®ï¼Œç­‰å¾…å·¥å…·è·å–æ¸¸æˆä¿¡æ¯å’ŒDLCåˆ—è¡¨</li>
                    <li>ç”Ÿæˆé…ç½®æ–‡ä»¶åï¼Œç‚¹å‡»"ä¸‹è½½é…ç½®æ–‡ä»¶"æŒ‰é’®ä¿å­˜cream_api.iniæ–‡ä»¶</li>
                    <li>ç‚¹å‡»"ä¸‹è½½DLLæ–‡ä»¶"æŒ‰é’®ä¸‹è½½æ‰€éœ€çš„DLLæ–‡ä»¶å‹ç¼©åŒ…</li>
                    <li>å°†ä¸‹è½½çš„cream_api.iniæ–‡ä»¶å’ŒDLLæ–‡ä»¶æ”¾ç½®åˆ°æ¸¸æˆæ ¹ç›®å½•ï¼ˆä¸åŸç‰ˆsteam_api.dllåŒä¸€ç›®å½•ï¼‰</li>
                    <li>å°†åŸç‰ˆsteam_api.dllé‡å‘½åä¸ºsteam_api_o.dllï¼ˆ64ä½æ¸¸æˆåˆ™ä¸ºsteam_api64.dllé‡å‘½åä¸ºsteam_api64_o.dllï¼‰</li>
                    <li>è¿è¡Œæ¸¸æˆï¼ŒDLCå†…å®¹åº”è¯¥å·²ç»è§£é”</li>
                </ol>
                <p><strong>æ³¨æ„ï¼š</strong>æŸäº›æ¸¸æˆå¯èƒ½æœ‰é¢å¤–çš„åä½œå¼Šæªæ–½ï¼Œæ­¤æ–¹æ³•å¯èƒ½ä¸é€‚ç”¨ã€‚è¯·å°Šé‡æ¸¸æˆå¼€å‘è€…çš„åŠ³åŠ¨æˆæœï¼Œæ”¯æŒæ­£ç‰ˆæ¸¸æˆã€‚</p>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2023 Steam DLCé…ç½®ç”Ÿæˆå™¨ | ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ | å·¥å…·ä½œè€…: å°è·¯å¤§ç‹å¤§ç‹å¤§ç‹ | 3DM: tangdgd</p>
            <p>æ¯ä¸ªæ¸¸æˆçš„IDè·å–å°±æ˜¯å•†åº—é“¾æ¥ä¸­çš„æ•°å­—</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOMå…ƒç´ 
            const appIdInput = document.getElementById('appId');
            const fetchBtn = document.getElementById('fetchBtn');
            const testBtn = document.getElementById('testBtn');
            const clearBtn = document.getElementById('clearBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const copyBtn = document.getElementById('copyBtn');
            const downloadDllBtn = document.getElementById('downloadDllBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressStep = document.getElementById('progressStep');
            const progressPercent = document.getElementById('progressPercent');
            const progressFill = document.getElementById('progressFill');
            const errorContainer = document.getElementById('errorContainer');
            const errorMessage = document.getElementById('errorMessage');
            const successContainer = document.getElementById('successContainer');
            const successMessage = document.getElementById('successMessage');
            const outputContainer = document.getElementById('outputContainer');
            const gameInfo = document.getElementById('gameInfo');
            const configPreview = document.getElementById('configPreview');
            const dlcContainer = document.getElementById('dlcContainer');
            
            // å…¨å±€å˜é‡
            let currentAppId = 0;
            let gameData = null;
            let dlcList = [];
            let configContent = '';
            
            // æ›´æ–°è¿›åº¦æ¡
            function updateProgress(step, percent, description) {
                progressStep.textContent = description || step;
                progressPercent.textContent = `${percent}%`;
                progressFill.style.width = `${percent}%`;
                
                if (percent > 0) {
                    progressContainer.style.display = 'block';
                }
                
                // å®Œæˆæ—¶éšè—è¿›åº¦æ¡
                if (percent >= 100) {
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                    }, 1000);
                }
            }
            
            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            function showError(message) {
                errorMessage.textContent = message;
                errorContainer.style.display = 'block';
                successContainer.style.display = 'none';
                
                // 5ç§’åè‡ªåŠ¨éšè—é”™è¯¯ä¿¡æ¯
                setTimeout(() => {
                    errorContainer.style.display = 'none';
                }, 5000);
            }
            
            // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
            function showSuccess(message) {
                successMessage.textContent = message;
                successContainer.style.display = 'block';
                errorContainer.style.display = 'none';
                
                // 5ç§’åè‡ªåŠ¨éšè—æˆåŠŸä¿¡æ¯
                setTimeout(() => {
                    successContainer.style.display = 'none';
                }, 5000);
            }
            
            // éšè—æ‰€æœ‰æ¶ˆæ¯
            function hideMessages() {
                errorContainer.style.display = 'none';
                successContainer.style.display = 'none';
            }
            
            // æ¸…ç©ºç»“æœ
            function clearResults() {
                outputContainer.style.display = 'none';
                gameData = null;
                dlcList = [];
                configContent = '';
                gameInfo.innerHTML = 'æ¸¸æˆä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ';
                configPreview.textContent = 'é…ç½®æ–‡ä»¶å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ';
                dlcContainer.innerHTML = '';
                hideMessages();
                progressContainer.style.display = 'none';
            }
            
            // ä½¿ç”¨CORSä»£ç†è¯·æ±‚æ•°æ®ï¼ˆé¿å…è·¨åŸŸé—®é¢˜ï¼‰
            async function makeRequest(url, maxRetries = 3) {
                // ä½¿ç”¨CORSä»£ç†ç»•è¿‡è·¨åŸŸé™åˆ¶
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const targetUrl = encodeURIComponent(url);
                
                for (let attempt = 0; attempt < maxRetries; attempt++) {
                    try {
                        const response = await fetch(`${proxyUrl}${targetUrl}`, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        return await response.json();
                    } catch (error) {
                        if (attempt < maxRetries - 1) {
                            const waitTime = Math.pow(2, attempt) * 1000;
                            console.log(`è¯·æ±‚å¤±è´¥ï¼Œ${waitTime/1000}ç§’åé‡è¯• (${attempt+1}/${maxRetries})...`);
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                        } else {
                            throw error;
                        }
                    }
                }
            }
            
            // æµ‹è¯•ç½‘ç»œè¿æ¥
            async function testConnection() {
                try {
                    updateProgress('æµ‹è¯•è¿æ¥', 10, 'æ­£åœ¨æµ‹è¯•ç½‘ç»œè¿æ¥...');
                    fetchBtn.disabled = true;
                    testBtn.disabled = true;
                    
                    // æµ‹è¯•è¿æ¥ï¼ˆä½¿ç”¨ä¸€ä¸ªå·²çŸ¥çš„Steam APIç«¯ç‚¹ï¼‰
                    await makeRequest('https://store.steampowered.com/api/appdetails?appids=292030&cc=us&l=english');
                    
                    updateProgress('æµ‹è¯•è¿æ¥', 100, 'ç½‘ç»œè¿æ¥æ­£å¸¸');
                    showSuccess('âœ“ ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨');
                    
                } catch (error) {
                    showError(`ç½‘ç»œè¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`);
                    console.error('è¿æ¥æµ‹è¯•é”™è¯¯:', error);
                } finally {
                    fetchBtn.disabled = false;
                    testBtn.disabled = false;
                    setTimeout(() => {
                        updateProgress('', 0, '');
                    }, 1500);
                }
            }
            
            // è·å–æ¸¸æˆä¿¡æ¯å’ŒDLCåˆ—è¡¨
            async function fetchGameInfo(appId) {
                try {
                    currentAppId = appId;
                    
                    // ç¬¬ä¸€æ­¥ï¼šè·å–åŸºç¡€æ¸¸æˆä¿¡æ¯
                    updateProgress('è·å–æ¸¸æˆä¿¡æ¯', 20, `æ­£åœ¨è·å–æ¸¸æˆ (AppID: ${appId}) çš„ä¿¡æ¯...`);
                    
                    const gameUrl = `https://store.steampowered.com/api/appdetails?appids=${appId}&cc=us&l=english`;
                    const gameData = await makeRequest(gameUrl);
                    
                    const appData = gameData[appId.toString()];
                    
                    if (!appData || !appData.success) {
                        throw new Error(`æœªæ‰¾åˆ°IDä¸º ${appId} çš„æ¸¸æˆæˆ–APIè¿”å›å¤±è´¥`);
                    }
                    
                    const gameName = appData.data.name || `Steam_Game_${appId}`;
                    const dlcIds = appData.data.dlc || [];
                    
                    updateProgress('è·å–æ¸¸æˆä¿¡æ¯', 50, `æˆåŠŸæ‰¾åˆ°æ¸¸æˆ: ${gameName}`);
                    
                    if (dlcIds.length === 0) {
                        updateProgress('å®Œæˆ', 100, `æ­¤æ¸¸æˆæ²¡æœ‰æ‰¾åˆ°ä»»ä½•DLC`);
                        return {
                            gameName,
                            dlcList: [],
                            originalName: gameName
                        };
                    }
                    
                    // ç¬¬äºŒæ­¥ï¼šè·å–DLCè¯¦ç»†ä¿¡æ¯
                    updateProgress('è·å–DLCä¿¡æ¯', 60, `å‘ç° ${dlcIds.length} ä¸ªDLCï¼Œæ­£åœ¨è·å–è¯¦ç»†ä¿¡æ¯...`);
                    
                    const dlcList = [];
                    let processedCount = 0;
                    
                    // æ‰¹é‡å¤„ç†DLCï¼Œé¿å…åŒæ—¶å‘èµ·å¤ªå¤šè¯·æ±‚
                    const batchSize = 5;
                    for (let i = 0; i < dlcIds.length; i += batchSize) {
                        const batch = dlcIds.slice(i, i + batchSize);
                        const batchPromises = batch.map(async (dlcId, index) => {
                            try {
                                const dlcUrl = `https://store.steampowered.com/api/appdetails?appids=${dlcId}&cc=us&l=english`;
                                const dlcData = await makeRequest(dlcUrl, 2);
                                
                                const dlcInfo = dlcData[dlcId.toString()];
                                
                                if (dlcInfo && dlcInfo.success) {
                                    dlcList.push({
                                        id: dlcId,
                                        name: dlcInfo.data.name || `DLC_${dlcId}`
                                    });
                                } else {
                                    dlcList.push({
                                        id: dlcId,
                                        name: `DLC_${dlcId}`
                                    });
                                }
                            } catch (error) {
                                // å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œä»ç„¶æ·»åŠ DLCæ¡ç›®ä½†ä½¿ç”¨é»˜è®¤åç§°
                                dlcList.push({
                                    id: dlcId,
                                    name: `DLC_${dlcId}`
                                });
                            }
                            
                            processedCount++;
                            const percent = 60 + Math.floor((processedCount / dlcIds.length) * 30);
                            updateProgress('è·å–DLCä¿¡æ¯', percent, `å·²å¤„ç† ${processedCount}/${dlcIds.length} ä¸ªDLC...`);
                        });
                        
                        // ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
                        await Promise.all(batchPromises);
                        
                        // æ‰¹æ¬¡ä¹‹é—´çŸ­æš‚å»¶è¿Ÿï¼Œé¿å…è¯·æ±‚è¿‡å¿«
                        if (i + batchSize < dlcIds.length) {
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                    }
                    
                    updateProgress('å®Œæˆ', 100, `æˆåŠŸè·å– ${dlcList.length} ä¸ªDLCä¿¡æ¯`);
                    
                    return {
                        gameName,
                        dlcList,
                        originalName: gameName
                    };
                    
                } catch (error) {
                    console.error('è·å–æ¸¸æˆä¿¡æ¯æ—¶å‡ºé”™:', error);
                    throw error;
                }
            }
            
            // ç”Ÿæˆé…ç½®æ–‡ä»¶å†…å®¹
            function generateConfig(appId, dlcList, gameName) {
                // è·å–å½“å‰æ—¶é—´ï¼Œæ ¼å¼ï¼š2026/1/2 00:18:48
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth() + 1;
                const day = now.getDate();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                const generatedTime = `${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;
                
                let config = `; cream_api.ini é…ç½®æ–‡ä»¶


[steam]
; Application ID (http://store.steampowered.com/app/%appid%/)
appid = ${appId}
; Current game language.
; Uncomment this option to turn it on.
; Default is "english".
;language = schinese
; Enable/disable automatic DLC unlock. Default option is set to "false".
; Keep in mind that this option  WON'T work properly if the "[dlc]" section is NOT empty
unlockall = false
; Original Valve's steam_api.dll.
; Default is "steam_api_o.dll".
orgapi = steam_api_o.dll
; Original Valve's steam_api64.dll.
; Default is "steam_api64_o.dll".
orgapi64 = steam_api64_o.dll
; Enable/disable extra protection bypasser.
; Default is "false".
extraprotection = false
; Add the specific files to hide from detection.
; Use comma (,) to separate the files. "cream_api.ini" is hidden by default.
;filestohide = steam_appid.txt,steam_emu.ini
; The game will think that you're offline (supported by some games).
; Default is "false".
forceoffline = false
; Some games are checking for the low violence presence.
; Default is "false".
;lowviolence = true
; Purchase timestamp for the DLC (http://www.onlineconversion.com/unix_time.htm).
; Default is "0" (1970/01/01).
;purchasetimestamp = 0

[steam_misc]
; Disables the internal SteamUser interface handler.
; Does have an effect on the games that are using the license check for the DLC/application.
; Default is "false".
disableuserinterface = false

[dlc]
; DLC handling.
; Format: <dlc_id> = <dlc_description>
; e.g. : 247295 = Saints Row IV - GAT V Pack
; If the DLC is not specified in this section
; then it won't be unlocked
`;
                
                // æ·»åŠ æ‰€æœ‰DLCæ¡ç›®
                dlcList.forEach(dlc => {
                    config += `${dlc.id}=${dlc.name}\n`;
                });
                
                return config;
            }
            
            // æ˜¾ç¤ºç»“æœ
            function displayResults(appId, gameName, dlcList, config) {
                gameData = { appId, gameName, dlcList };
                configContent = config;
                
                // æ˜¾ç¤ºæ¸¸æˆä¿¡æ¯
                gameInfo.innerHTML = `
                    <p><strong>ğŸ® æ¸¸æˆåç§°:</strong> ${gameName}</p>
                    <p><strong>ğŸ†” åŸºç¡€æ¸¸æˆID:</strong> ${appId}</p>
                    <p><strong>ğŸ“¦ DLCæ•°é‡:</strong> ${dlcList.length}</p>
                `;
                
                // æ˜¾ç¤ºé…ç½®æ–‡ä»¶é¢„è§ˆ
                configPreview.textContent = config;
                
                // æ˜¾ç¤ºDLCåˆ—è¡¨
                if (dlcList.length > 0) {
                    let dlcHTML = `<h3><i class="fas fa-box-open"></i> DLCåˆ—è¡¨ (å…±${dlcList.length}ä¸ª)</h3>`;
                    dlcHTML += '<div class="dlc-list">';
                    
                    // æ˜¾ç¤ºå‰12ä¸ªDLCï¼Œé¿å…é¡µé¢è¿‡é•¿
                    const displayCount = Math.min(dlcList.length, 12);
                    for (let i = 0; i < displayCount; i++) {
                        const dlc = dlcList[i];
                        const dlcDisplayName = dlc.name.length > 60 ? dlc.name.substring(0, 60) + '...' : dlc.name;
                        dlcHTML += `
                            <div class="dlc-item">
                                <div class="dlc-id">${dlc.id}</div>
                                <div class="dlc-name">${dlcDisplayName}</div>
                            </div>
                        `;
                    }
                    
                    dlcHTML += '</div>';
                    
                    if (dlcList.length > displayCount) {
                        dlcHTML += `<p style="margin-top: 15px; color: #8a8a8a;">... è¿˜æœ‰ ${dlcList.length - displayCount} ä¸ªDLCæœªæ˜¾ç¤º</p>`;
                    }
                    
                    dlcContainer.innerHTML = dlcHTML;
                } else {
                    dlcContainer.innerHTML = '<p style="color: #8a8a8a;">æ­¤æ¸¸æˆæœªå‘ç°DLCï¼Œé…ç½®æ–‡ä»¶ä»…åŒ…å«åŸºç¡€è®¾ç½®</p>';
                }
                
                // æ˜¾ç¤ºè¾“å‡ºå®¹å™¨
                outputContainer.style.display = 'block';
                
                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                outputContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
                showSuccess(`âœ… é…ç½®ç”ŸæˆæˆåŠŸï¼å…±æ‰¾åˆ° ${dlcList.length} ä¸ªDLC`);
            }
            
            // ä¸‹è½½é…ç½®æ–‡ä»¶
            function downloadConfig() {
                if (!configContent) {
                    showError('æ²¡æœ‰å¯ä¸‹è½½çš„é…ç½®æ–‡ä»¶å†…å®¹');
                    return;
                }
                
                // æ–‡ä»¶åå›ºå®šä¸º cream_api.ini
                const filename = `cream_api.ini`;
                
                const blob = new Blob([configContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                
                URL.revokeObjectURL(url);
                
                showSuccess(`é…ç½®æ–‡ä»¶å·²ä¸‹è½½: ${filename}`);
            }
            
            // å¤åˆ¶é…ç½®å†…å®¹åˆ°å‰ªè´´æ¿
            async function copyConfigToClipboard() {
                if (!configContent) {
                    showError('æ²¡æœ‰å¯å¤åˆ¶çš„é…ç½®æ–‡ä»¶å†…å®¹');
                    return;
                }
                
                try {
                    await navigator.clipboard.writeText(configContent);
                    showSuccess('é…ç½®å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                } catch (error) {
                    console.error('å¤åˆ¶å¤±è´¥:', error);
                    showError('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é…ç½®å†…å®¹');
                }
            }
            
            // ä¸‹è½½DLLæ–‡ä»¶
            function downloadDllFiles() {
                // å‡è®¾DLLå‹ç¼©æ–‡ä»¶åœ¨myæ–‡ä»¶å¤¹å†…ï¼Œæ–‡ä»¶åä¸º"steam_api64.dll and steam_api.dll.rar"
                // æ³¨æ„ï¼šæ–‡ä»¶åä¸­æœ‰ç©ºæ ¼ï¼Œéœ€è¦è¿›è¡ŒURLç¼–ç 
                const dllFileName = "steam_api64.dll and steam_api.dll.rar";
                const encodedFileName = encodeURIComponent(dllFileName);
                const fileUrl = `./my/${encodedFileName}`;
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const a = document.createElement('a');
                a.href = fileUrl;
                a.download = dllFileName;
                a.click();
                
                showSuccess('DLLæ–‡ä»¶ä¸‹è½½å·²å¼€å§‹ï¼æ–‡ä»¶åä¸º: ' + dllFileName);
            }
            
            // ä¸»å‡½æ•°ï¼šè·å–DLCä¿¡æ¯å¹¶ç”Ÿæˆé…ç½®
            async function fetchDLCInfo() {
                const appId = parseInt(appIdInput.value.trim());
                
                if (!appId || appId <= 0) {
                    showError('è¯·è¾“å…¥æœ‰æ•ˆçš„Steam App IDï¼ˆæ­£æ•´æ•°ï¼‰');
                    appIdInput.focus();
                    return;
                }
                
                // ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
                fetchBtn.disabled = true;
                testBtn.disabled = true;
                hideMessages();
                
                try {
                    // è·å–æ¸¸æˆä¿¡æ¯å’ŒDLCåˆ—è¡¨
                    const result = await fetchGameInfo(appId);
                    
                    // ç”Ÿæˆé…ç½®æ–‡ä»¶
                    updateProgress('ç”Ÿæˆé…ç½®', 95, 'æ­£åœ¨ç”Ÿæˆé…ç½®æ–‡ä»¶...');
                    const config = generateConfig(appId, result.dlcList, result.gameName);
                    
                    // æ˜¾ç¤ºç»“æœ
                    displayResults(appId, result.gameName, result.dlcList, config);
                    
                } catch (error) {
                    console.error('è·å–DLCä¿¡æ¯æ—¶å‡ºé”™:', error);
                    showError(`è·å–DLCä¿¡æ¯å¤±è´¥: ${error.message}`);
                } finally {
                    // é‡æ–°å¯ç”¨æŒ‰é’®
                    fetchBtn.disabled = false;
                    testBtn.disabled = false;
                    updateProgress('å®Œæˆ', 100, 'æ“ä½œå®Œæˆ');
                }
            }
            
            // äº‹ä»¶ç›‘å¬å™¨
            fetchBtn.addEventListener('click', fetchDLCInfo);
            
            testBtn.addEventListener('click', testConnection);
            
            clearBtn.addEventListener('click', clearResults);
            
            downloadBtn.addEventListener('click', downloadConfig);
            
            copyBtn.addEventListener('click', copyConfigToClipboard);
            
            downloadDllBtn.addEventListener('click', downloadDllFiles);
            
            appIdInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    fetchDLCInfo();
                }
            });
            
            // åˆå§‹åŒ–ï¼šæµ‹è¯•ç½‘ç»œè¿æ¥
            setTimeout(() => {
                // è‡ªåŠ¨æµ‹è¯•è¿æ¥ï¼Œä½†ä¸æ˜¾ç¤ºç»“æœ
                testConnection();
            }, 1000);
        });
    </script>
</body>
</html>
